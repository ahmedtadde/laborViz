{
    "collab_server" : "",
    "contents" : "# =========================================================================\n# function libraries\n# @description: load all libraries for project\n# @return: N/A\n# =========================================================================\nlibraries <- function(){\n  library(rvest)\n  library(data.table)\n  library(dplyr)\n  library(reshape2)\n  library(shiny)\n  library(ggplot2)\n  library(scales)\n  options(warn=-1)\n}\n\n\n\n\n# =========================================================================\n# function get_data_labor_trend\n#\n# @description: get data from cps url.\n# @return: reshaped dataframe of labor over time\n# =========================================================================\nget_labor_trend <- function() {\n    url <- \"http://www.bls.gov/cps/cpsaat02.htm\"\n    \n    colnames <- c(\n      \"year\", \n      \"Total Population\",\n      \"Labor Force (Total)\",\n      \"% Labor Force (Total)\",\n      \"Labor Force (Employed)\",\n      \"% Labor Force (Employed)\",\n      \"Labor Force (Agriculture)\",\n      \"Labor Force (Non-agriculture)\",\n      \"Labor Force (Unemployed)\",\n      \"% Labor Force (Unemployed)\",\n      \"Non-Labor Force (Total)\"\n    )\n    \n    table <- url %>% \n      html() %>%\n      html_nodes('table#cps_eeann_year_sex.regular')%>%html_table(header= FALSE, fill=TRUE)\n    \n    table <- data.table(table[[1]])\n    setnames(table, colnames)\n    \n    table <- rbindlist(list(table[5:42][,gender:= \"Men\"],table[48:88][,gender:=\"Women\"]), use.names = TRUE)\n    \n    table <- melt.data.table(\n      table,\n      id.vars = c(\"year\", \"gender\"),\n      variable.name = \"population\", \n      value.name = \"value\"\n    )[, c(\"population\", \"value\") := list(as.character(population), as.numeric(gsub(\",\",\"\",value)))]\n    \n    return(setkeyv(table, c(\"year\", \"gender\")))\n}\n\n\n\n# =========================================================================\n# function get_labor_occupation\n#\n# @description: get data from cps url.\n# @return: reshaped dataframe of employed people by age,race, gender, occupation\n# =========================================================================\nget_labor_occupation <- function() {\n  url <- \"http://www.bls.gov/cps/cpsaat14.htm\"\n  colnames <- c(\"age_group\",\n                \"Mining/Extraction\",\n                \"Construction\",\n                \"Manufacturing\",\n                \"Wholesale/Retail\",\n                \"Transportation/Utilities\",\n                \"Information Services\",\n                \"Finance Services\",\n                \"Professional/Business Services\",\n                \"Education/Health Services\",\n                \"Leisure Services\",\n                \"Other Services\",\n                \"Public Administration\")\n  \n  table <- url %>% \n    html() %>%\n    html_nodes('#cps_eeann_emp_nonag')%>%html_table(header= FALSE, fill=TRUE)\n  \n  table <- data.table(table[[1]])[25:dim(table[[1]])[1]][1:64]\n  setnames(table, colnames)\n  \n  table_white <- table[2:16][age_group %in% c(\"16 to 19 years\",\"20 to 24 years\",\"25 to 54 years\",\"55 years and over\")\n                             ][, race:= \"White\"][, gender:= rep(c(\"Men\", \"Women\"), each=4)]\n  \n  table_black <- table[18:32][age_group %in% c(\"16 to 19 years\",\"20 to 24 years\",\"25 to 54 years\",\"55 years and over\")\n                              ][, race:= \"Black\"][, gender:= rep(c(\"Men\", \"Women\"), each=4)]\n  \n  table_asian <- table[34:48][age_group %in% c(\"16 to 19 years\",\"20 to 24 years\",\"25 to 54 years\",\"55 years and over\")\n                              ][, race:= \"Asian\"][, gender:= rep(c(\"Men\", \"Women\"), each=4)]\n  \n  table_hispanic <- table[50:64][age_group %in% c(\"16 to 19 years\",\"20 to 24 years\",\"25 to 54 years\",\"55 years and over\")\n                                 ][, race:= \"Hispanic\"][, gender:= rep(c(\"Men\", \"Women\"), each=4)]\n  \n  \n  table <- rbindlist(list(table_white,table_black,table_asian,table_hispanic), use.names = T)\n  rm(list = c(\"table_white\",\"table_black\", \"table_asian\",\"table_hispanic\",\"colnames\",\"url\"))\n  \n  table <- melt.data.table(table, id.vars = c(\"age_group\",\"race\",\"gender\"), variable.name = \"occupation\")\n  \n  table[, c(\"occupation\",\"value\" ):= list(as.character(occupation), as.numeric(gsub(\",\",\"\",value)))\n        ][,percentage:= round(value / sum(value) * 100, 2), by = list(age_group,race,gender)]\n  \n  return(setkey(table, age_group, race, gender,occupation))\n}\n\n\n\n# =========================================================================\n# function get_labor_education\n#\n# @description: get data from cps url.\n# @return: reshaped dataframe of employed people by education attainment\n# =========================================================================\nget_labor_education <- function() {\n  url <- \"http://www.bls.gov/cps/cpsaat07.htm\"\n  colnames <- c(\"metric\",\n                \"Less than High School\",\n                \"High School\",\n                \"Some College or Associate Degree\",\n                \"Some College No Degree\",\n                \"Some College Associate Degree\",\n                \"Bachelors Degree or Higher\",\n                \"Bachelors Degree\",\n                \"Advanced Degree\"\n  )\n  \n  table <- url %>%\n    html() %>%\n    html_nodes('#cps_eeann_educ')%>%html_table(header= FALSE, fill=TRUE)\n  \n  table <- data.table(table[[1]])[4:59]\n  setnames(table, colnames)\n  \n  table_total <- table[2:8][,category:= \"Total\"]\n  table_men <- table[10:16][,category:= \"Men\"]\n  table_women <- table[18:24][,category:= \"Women\"]\n  table_white <- table[26:32][,category:= \"White\"]\n  table_black <- table[34:40][,category:= \"Black\"]\n  table_asian <- table[42:48][,category:= \"Asian\"]\n  table_hispanic <- table[50:56][,category:= \"Hispanic\"]\n  \n  table <- rbindlist(list(table_total, table_men, table_women, table_white,table_black,table_asian,table_hispanic))\n  rm(list = c(\"table_total\",\"table_men\",\"table_women\",\"table_white\",\"table_black\", \"table_asian\",\"table_hispanic\",\"colnames\",\"url\"))\n  \n  table <- melt.data.table(table, id.vars = c(\"metric\",\"category\"), variable.name = \"education\")\n  table[, c(\"education\", \"value\"):= list(as.character(education), as.numeric(gsub(\",\",\"\",value)))]\n  return(setkey(table, metric, category, education))\n  \n}",
    "created" : 1494350301518.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2263718394",
    "id" : "BEC97CC0",
    "lastKnownWriteTime" : 1494364123,
    "last_content_update" : 1494364123080,
    "path" : "~/GITHUB/laborViz/data/functions.R",
    "project_path" : "data/functions.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : true,
    "source_window" : "",
    "type" : "r_source"
}