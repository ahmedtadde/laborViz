{
    "collab_server" : "",
    "contents" : "# load libraries\nlibrary(XML)\nlibrary(dplyr)\nlibrary(reshape2)\noptions(warn=-1)  # turn off unneccesary NON-EXISTING NA warnings in the code from XML library\n\n\n\n# =========================================================================\n# function get_data_labor_trend\n#\n# @description: get data from cps url.\n# @return: reshaped dataframe of labor over time\n# =========================================================================\nget_labor_trend <- function() {\n    url <- \"http://www.bls.gov/cps/cpsaat02.htm\"\n    colnames <- c(\"year\" = \"integer\",\n                  \"Total Population\" = \"FormattedInteger\",\n                  \"Labor Force (Total)\" = \"FormattedInteger\",\n                  \"% Labor Force (Total)\" = \"numeric\",\n                  \"Labor Force (Employed)\" = \"FormattedInteger\",\n                  \"% Labor Force (Employed)\" = \"numeric\",\n                  \"Labor Force (Agriculture)\" = \"FormattedInteger\",\n                  \"Labor Force (Non-agriculture)\" = \"FormattedInteger\",\n                  \"Labor Force (Unemployed)\" = \"FormattedInteger\",\n                  \"% Labor Force (Unemployed)\" = \"numeric\",\n                  \"Non-Labor Force (Total)\" = \"FormattedInteger\")\n    \n    # get data\n    tables <- readHTMLTable(url, stringsAsFactors=FALSE, colClasses=unname(colnames))\n    df <- tables[[2]]  # data is in second table in html\n    \n    # reshape data\n    colnames(df) <- names(colnames)  # rename columns\n    df <- df %>% na.omit()  # remove NAs\n    genders <- rep(c(\"Men\", \"Women\"), each=nrow(df)/2)  # create genders column to correct length\n    \n    df <- df %>% mutate(gender = genders)  # add gender column\n    df <- melt(df, id=c(\"year\", \"gender\")) %>%  # melt from wide to long\n        rename(population = variable) %>%\n        mutate(population = as.character(population)) %>%\n        arrange(gender, population)\n    return(df)\n}\n\n\n\n# =========================================================================\n# function get_labor_occupation\n#\n# @description: get data from cps url.\n# @return: reshaped dataframe of employed people by occupation, sex, ethnicity, age\n# =========================================================================\nget_labor_occupation <- function() {\n    url <- \"http://www.bls.gov/cps/cpsaat14.htm\"\n    colnames <- c(\"age_group\" = \"character\",\n                  \"Mining/Extraction\" = \"FormattedInteger\",\n                  \"Construction\" = \"FormattedInteger\",\n                  \"Manufacturing\" = \"FormattedInteger\",\n                  \"Wholesale/Retail\" = \"FormattedInteger\",\n                  \"Transportation/Utilities\" = \"FormattedInteger\",\n                  \"Information Services\" = \"FormattedInteger\",\n                  \"Finance Services\" = \"FormattedInteger\",\n                  \"Professional/Business Services\" = \"FormattedInteger\",\n                  \"Education/Health Services\" = \"FormattedInteger\",\n                  \"Leisure Services\" = \"FormattedInteger\",\n                  \"Other Services\" = \"FormattedInteger\",\n                  \"Public Administration\" = \"FormattedInteger\")\n    \n    # get data\n    tables <- readHTMLTable(url, stringsAsFactors=FALSE, colClasses=unname(colnames))\n    df <- tables[[2]]  # data is in second table in html\n    \n    # reshape data\n    colnames(df) <- names(colnames)  # rename columns\n    df <- df %>%\n        na.omit()  %>% # remove NAs\n        filter(age_group %in% c(\"16 to 19 years\",  # filter only certain rows\n                                \"20 to 24 years\",\n                                \"25 to 54 years\",\n                                \"55 years and over\")) %>%\n        slice((4*3+1):1000)  # skip the first few sections (total)\n    races <- rep(c(\"White\", \"Black\", \"Asian\", \"Hispanic\"), each=nrow(df)/4)  # create races column to correct length\n    genders <- rep(rep(c(\"Men\", \"Women\"), each=4), 4)  # create genders column to correct length - 4 (age) * 4 (race)\n    df <- df %>%\n        mutate(gender = genders,  # add gender and race columns\n               race = races)\n    df <- melt(df, id=c(\"age_group\", \"gender\", \"race\")) %>%  # melt from wide to long\n        rename(occupation = variable) %>%\n        mutate(occupation = as.character(occupation)) %>%\n        group_by(age_group, gender, race) %>%\n        mutate(percentage = round(value / sum(value) * 100, 2))\n    return(df)\n}\n\n\n\n# =========================================================================\n# function get_labor_education\n#\n# @description: get data from cps url.\n# @return: reshaped dataframe of employed people by education attainment\n# =========================================================================\nget_labor_education <- function() {\n    url <- \"http://www.bls.gov/cps/cpsaat07.htm\"\n    colnames <- c(\"metric\" = \"character\",\n                  \"Less than High School (old)\" = \"FormattedNumber\",\n                  \"Less than High School\" = \"FormattedNumber\",\n                  \"High School (old)\" = \"FormattedNumber\",\n                  \"High School\" = \"FormattedNumber\",\n                  \"Some College Total (old)\" = \"FormattedNumber\",\n                  \"Some College Total\" = \"FormattedNumber\",\n                  \"Some College No Degree (old)\" = \"FormattedNumber\",\n                  \"Some College No Degree\" = \"FormattedNumber\",\n                  \"Some College Associate Degree (old)\" = \"FormattedNumber\",\n                  \"Some College Associate Degree\" = \"FormattedNumber\",\n                  \"Bachelors Degree (old)\" = \"FormattedNumber\",\n                  \"Bachelors Degree\" = \"FormattedNumber\")\n    \n    # get data\n    tables <- readHTMLTable(url, stringsAsFactors=FALSE, colClasses=unname(colnames))\n    df <- tables[[2]]  # data is in second table in html\n    \n    # reshape data\n    keeps <- c(\"metric\", \"Less than High School\", \"High School\", \"Some College No Degree\", \"Some College Associate Degree\", \"Bachelors Degree\")  # columns to keep\n    colnames(df) <- names(colnames)  # rename columns\n    df <- df[, keeps]  # keep only some columns\n    df <- df %>% na.omit()  # remove NAs\n    categories <- rep(c(\"Total\", \"Men\", \"Women\", \"White\", \"Black\", \"Asian\", \"Hispanic\"), each=nrow(df)/7)  # create categories column to correct length\n    df <- df %>% mutate(category = categories)  # add category column\n    df <- melt(df, id=c(\"metric\", \"category\")) %>%  # melt from wide to long\n        rename(education = variable) %>%\n        mutate(education = as.character(education))\n    return(df)\n}",
    "created" : 1494290784243.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2507586865",
    "id" : "7D4CE1B6",
    "lastKnownWriteTime" : 1494292015,
    "last_content_update" : 1494292015114,
    "path" : "~/Documents/GitHub/laborViz/data/parser.R",
    "project_path" : "data/parser.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : true,
    "source_window" : "",
    "type" : "r_source"
}